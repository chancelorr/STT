      subroutine triq(nx, ny)
	implicit double precision (a-h,o-z)
c$$$$ calls no other routines
c  Constructs the conical product quadrature formula for integration
c  over the plane triangular region  0.le.x, 0.le.y, x+y.le.1. see
c  Stroud,1971, 'Approximate Calculation of Multiple Integrals',pp28-30.
c  nx  is the number of sample points desired along  x  lines
c  ny  the number along  y  lines
c  nquad   the number of sample points generated.  ideally this is
c      nx*ny, but may differ from this because of the limited
c      number of gauss formulas stored.
c xyw  triples of  x-y coordintes and weights generated for the
c      quadrature formula.  if n=min(nx,ny), the formula is
c      exact for polynomials in x**p*y**q  where p+q.le.2*n-1.
c  if  nx  is negative the routine supplies the special 7-point degree 5
c  formula of Stroud (*T2 5-1, page 315).
c
c  The results are loaded into the common /rule/
c
      common /rule/ xyw(3,100),nquad
      common /io/ inp,iout,iprint
      dimension ixp(15),xw(316),iyp(9),yw(72),zw(21)
c
c  Gauss formulas with w(x)=1, with orders 2,3,...10,12,16,20,24,32.
      data ixp/1,5,11,19,29,41,55,71,89,109,133,165,205,253,317/
      data (xw(j),j=1,54)/
     $ 0.2113248654, 0.5000000000, 0.7886751346, 0.5000000000,            ord 2
     $ 0.1127016654, 0.2777777778, 0.5000000000, 0.4444444444,            ord 3
     $ 0.8872983346, 0.2777777778,
     $ 0.0694318442, 0.1739274225, 0.3300094782, 0.3260725774,            ord 4
     $ 0.6699905218, 0.3260725774, 0.9305681558, 0.1739274225,
     $ 0.0469100771, 0.1184634425, 0.2307653450, 0.2393143352,            ord 5
     $ 0.5000000000, 0.2844444444, 0.7692346550, 0.2393143352,
     $ 0.9530899229, 0.1184634425,
     $ 0.0337652429, 0.0856622462, 0.1693953068, 0.1803807865,           ord 6
     $ 0.3806904070, 0.2339569673, 0.6193095930, 0.2339569673,
     $ 0.8306046932, 0.1803807865, 0.9662347571, 0.0856622462,
     $ 0.0254460439, 0.0647424831, 0.1292344072, 0.1398526957,           ord 7
     $ 0.2970774243, 0.1909150252, 0.5000000000, 0.2089795918,
     $ 0.7029225757, 0.1909150252, 0.8707655928, 0.1398526957,
     $ 0.9745539561, 0.0647424831/
      data (xw(j),j=55,108)/
     $ 0.0198550718, 0.0506142681, 0.1016667613, 0.1111905172,           ord 8
     $ 0.2372337951, 0.1568533229, 0.4082826788, 0.1813418917,
     $ 0.5917173212, 0.1813418917, 0.7627662049, 0.1568533229,
     $ 0.8983332387, 0.1111905172, 0.9801449282, 0.0506142681,
     $ 0.0159198803, 0.0406371942, 0.0819844464, 0.0903240803,           ord 9
     $ 0.1933142837, 0.1303053482, 0.3378732883, 0.1561735385,
     $ 0.5000000000, 0.1651196775, 0.6621267117, 0.1561735385,
     $ 0.8066857163, 0.1303053482, 0.9180155536, 0.0903240803,
     $ 0.9840801197, 0.0406371942,
     $ 0.0130467358, 0.0333356722, 0.0674683167, 0.0747256746,           ord 10
     $ 0.1602952159, 0.1095431812, 0.2833023030, 0.1346333596,
     $ 0.4255628305, 0.1477621123, 0.5744371695, 0.1477621123,
     $ 0.7166976970, 0.1346333596, 0.8397047841, 0.1095431812,
     $ 0.9325316833, 0.0747256746, 0.9869532642, 0.0333356722/
      data (xw(j),j=109,164)/
     $ 0.0092196830, 0.0235876680, 0.0479413720, 0.0534696630,           ord 12
     $ 0.1150486630, 0.0800391645, 0.2063410230, 0.1015837135,
     $ 0.3160842505, 0.1167462685, 0.4373832955, 0.1245735230,
     $ 0.5626167045, 0.1245735230, 0.6839157495, 0.1167462685,
     $ 0.7936589770, 0.1015837135, 0.8849513370, 0.0800391645,
     $ 0.9520586280, 0.0534696630, 0.9907803170, 0.0235876680,
     $ 0.0052995328, 0.0135762297, 0.0277124885, 0.0311267620,           ord 16
     $ 0.0671843988, 0.0475792558, 0.1222977958, 0.0623144856,
     $ 0.1910618778, 0.0747979944, 0.2709916112, 0.0845782597,
     $ 0.3591982246, 0.0913017075, 0.4524937451, 0.0947253052,
     $ 0.5475062549, 0.0947253052, 0.6408017754, 0.0913017075,
     $ 0.7290083888, 0.0845782597, 0.8089381222, 0.0747979944,
     $ 0.8777022042, 0.0623144856, 0.9328156012, 0.0475792558,
     $ 0.9722875115, 0.0311267620, 0.9947004672, 0.0135762297/
      data (xw(j),j=165,240)/
     $ 0.0034357004, 0.0088070035, 0.0180140364, 0.0203007149,           ord 20
     $ 0.0438827859, 0.0313360241, 0.0804415141, 0.0416383708,
     $ 0.1268340468, 0.0509650599, 0.1819731597, 0.0590972660,
     $ 0.2445664990, 0.0658443192, 0.3131469557, 0.0710480546,
     $ 0.3861070745, 0.0745864933, 0.4617367395, 0.0763766935,
     $ 0.5382632605, 0.0763766935, 0.6138929255, 0.0745864933,
     $ 0.6868530443, 0.0710480546, 0.7554335010, 0.0658443192,
     $ 0.8180268403, 0.0590972660, 0.8731659532, 0.0509650599,
     $ 0.9195584859, 0.0416383708, 0.9561172141, 0.0313360241,
     $ 0.9819859636, 0.0203007149, 0.9965642996, 0.0088070035,
     $ 0.0024063900, 0.0061706150, 0.0126357220, 0.0142656945,           ord 24
     $ 0.0308627240, 0.0221387195, 0.0567922365, 0.0296492925,
     $ 0.0899990070, 0.0366732405, 0.1299379040, 0.0430950807,
     $ 0.1759531740, 0.0488093260, 0.2272892645, 0.0537221350,
     $ 0.2831032460, 0.0577528340, 0.3424786600, 0.0608352365,
     $ 0.4044405663, 0.0629187280, 0.4679715535, 0.0639690975,
     $ 0.5320284465, 0.0639690975, 0.5955594337, 0.0629187280,
     $ 0.6575213400, 0.0608352365, 0.7168967540, 0.0577528340,
     $ 0.7727107355, 0.0537221350, 0.8240468260, 0.0488093260/
      data (xw(j),j=241,316)/
     $ 0.8700620960, 0.0430950807, 0.9100009930, 0.0366732405,
     $ 0.9432077635, 0.0296492925, 0.9691372760, 0.0221387195,
     $ 0.9873642780, 0.0142656945, 0.9975936100, 0.0061706150,
     $ 0.0013680695, 0.0035093050, 0.0071942445, 0.0081371970,           ord 32
     $ 0.0176188725, 0.0126960325, 0.0325469625, 0.0171369310,
     $ 0.0518394225, 0.0214179490, 0.0753161935, 0.0254990295,
     $ 0.1027581025, 0.0293420465, 0.1339088910, 0.0329111110,
     $ 0.1684778670, 0.0361728970, 0.2061421215, 0.0390969475,
     $ 0.2465500460, 0.0416559620, 0.2893243620, 0.0438260465,
     $ 0.3340656990, 0.0455869390, 0.3803563190, 0.0469221995,
     $ 0.4277640195, 0.0478193600, 0.4758461675, 0.0482700440,
     $ 0.5241538325, 0.0482700440, 0.5722359805, 0.0478193600,
     $ 0.6196436810, 0.0469221995, 0.6659343010, 0.0455869390,
     $ 0.7106756380, 0.0438260465, 0.7534499540, 0.0416559620,
     $ 0.7938578785, 0.0390969475, 0.8315221330, 0.0361728970,
     $ 0.8660911090, 0.0329111110, 0.8972418975, 0.0293420465,
     $ 0.9246838065, 0.0254990295, 0.9481605775, 0.0214179490,
     $ 0.9674530375, 0.0171369310, 0.9823811275, 0.0126960325,
     $ 0.9928057555, 0.0081371970, 0.9986319305, 0.0035093050/
c
c  Gauss formulas w(x)=x, with orders 1,2 ... 8.
      data iyp/1,3,7,13,21,31,43,57,73/
      data yw/
     $0.6666666667, 0.5,                                                 ord 1
     $.3550510257, .1819586183,.8449489743,.3180413817,                  ord 2
     $.2123405382,.0698269799,.5905331356,.2292411064,                   ord 3
     $.9114120405,.2009319137,                                           ord 3
     $.1397598643,.0311809710,.4164095676,.1298475476,                   ord 4
     $.7231569864,.2034645680,.9428958039,.1355069134,                   ord 4
     $.0985350858,.0157479145,.3045357266,.0739088701,.5620251898,       ord 5
     $.1463869871,.8019865821,.1671746381,.9601901429,.0967815902,       ord 5
     $.0730543287,.0087383018,.2307661380,.0439551656,.4413284812,       ord 6
     $.0986611509,.6630153097,.1407925538,.8519214003,.1355424972,       ord 6
     $.9706835728,.0723103307,                                           ord 6
     $.0562625605,.0052143622,.1802406917,.0274083567,.3526247171,       ord 7
     $.0663846965,.5471536263,.1071250657,.7342101772,.1273908973,       ord 7
     $.8853209468,.1105092582,.9775206136,.0559673634,                   ord 7
     $.0446339553,.0032951914,.1443662570,.0178429027,.2868247571,       ord 8
     $.0454393195,.4548133152,.0791995995,.6280678354,.1060473594,       ord 8
     $.7856915206,.1125057995,.9086763921,.0911190236,                   ord 8
     $.9822200849,.0445508044/                                           ord 8
c  Special degree 5 formula.
      data zw/0.333333333, 0.333333333, 0.1125,
     $0.101286507, 0.101286507, 0.062969590,
     $0.797426985, 0.101286507, 0.062969590,
     $0.101286507, 0.797426985, 0.062969590,
     $0.470142064, 0.470142064, 0.066197076,
     $0.059715871, 0.470142064, 0.066197076,
     $0.470142064, 0.059715871, 0.066197076/
c
c
c  Find sample numbers closest to those input
      if (nx.lt.0) goto 2000
      ntwo=2*nx
      do 1100 mx=1, 14
 1100 if (ixp(mx+1)-ixp(mx).ge.ntwo) goto 1110
      mx=14
 1110 my=min0(ny, 8)
c
      mx1=ixp(mx)
      mx2=ixp(mx+1) - 1
      my1=iyp(my)
      my2=iyp(my+1) - 1
c
c  Create the product formula.
      m=0
      do 1500 i=mx1, mx2, 2
      do 1500 j=my1, my2, 2
      m=1 + m
      xyw(1,m)=1.0 - yw(j)
      xyw(2,m)=yw(j)*xw(i)
      xyw(3,m)=yw(j+1)*xw(i+1)
 1500 continue
      nquad=m
      if (iprint .ge. 3) write(iout,150) ((xyw(i,j),i=1,3), j=1,nquad)
 150  format(/' Quadrature coordinates and weights'/(3f8.4,3x,3f8.4))
      return
c  Copy special formula into output array.
 2000 m=7
      do 2100 j=1, 7
      do 2100 i=1,3
 2100 xyw(i,j)=zw(3*(j-1)+i)
      nquad=m
      if (iprint .ge. 3) write(iout,150) ((xyw(i,j),i=1,3), j=1,nquad)
      return
      end
c_______________________________________________________________________
